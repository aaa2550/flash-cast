# /frontend_v2/nginx.conf

# 建议在生产环境中增加 worker_processes 的数量
worker_processes 1;

events {
    worker_connections 1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;

    # HTTP Server
    server {
        # Nginx 将监听 8888 端口作为统一入口
        listen       8888;
        server_name  localhost;

        # 规则一：处理 API 请求
        # 所有以 /api/ 开头的请求，都转发给后端服务
        location /api/ {
            # 这里假设您的后端服务运行在 localhost 的 8080 端口
            proxy_pass http://127.0.0.1:8080;

            # 设置一些必要的请求头，以便后端能正确识别原始请求信息
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # 规则二：处理所有其他请求（例如网页、图片、JS、CSS等）
        # 将它们转发给 React 开发服务器
        location / {
            # 这里假设您的 React 开发服务器运行在 localhost 的 3000 端口
            proxy_pass http://127.0.0.1:3000;

            # 以下配置对于 create-react-app 的热更新功能至关重要
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}
